local old_time = 0
local number = 0;
local localPlayerClient;
local localPlayer;

local fishExploitsEnabled = gui.add_checkbox("Fish Exploits", false);
local fishSpinbotEnabled = gui.add_checkbox("Fish Spinbot", false);
local fishSpinbotSpeed = gui.add_slider("Spinbot Speed", 1, 300, 150);
local fishDeadFishEnabled = gui.add_checkbox("Kill Fish", false);
local fishFeetEnabled = gui.add_checkbox("Fish Feet", false);
local fishModelChangerEnabled = gui.add_checkbox("Fish Model Changer", false);
local fishModelIndex = gui.add_slider("Fish Model Index", 50, 758, 758);

local function setFishValues(fishEnt, origin, x, y, z)
    if (origin ~= nil) then
        fishEnt:set_prop("DT_CFish:m_poolOrigin", origin)
    end

    if (x ~= nil and y ~= nil and z ~= nil) then
        fishEnt:set_prop("DT_CFish:m_x", x)
        fishEnt:set_prop("DT_CFish:m_y", y)
        fishEnt:set_prop("DT_CFish:m_z", z + 10)
    end
end

function on_render()
    if (fishExploitsEnabled:get_value()) then
        localPlayerClient = engine.localplayer();
        localPlayer = entitylist.get_entity(localPlayerClient);
        local curtime = globalvars.curtime

        if (localPlayer) then  
            local localOrigin = localPlayer:get_origin();

            if (fishSpinbotEnabled:get_value()) then
                if (fishSpinbotSpeed:get_value() >= 1 and fishSpinbotSpeed:get_value() <= 300) then
                    if (curtime - old_time) >= fishSpinbotSpeed:get_value() / 10000 then
                        if (number >= 360) then number= 0; end
                        number = number + 1
                        old_time = curtime
                    end
                end
            end

            local fishEnts = entitylist.get_entities_by_class("CFish")
            for i = 1, #fishEnts do
                if (fishSpinbotEnabled:get_value()) then
                    fishEnts[i]:set_prop("DT_CFish:m_angle", number)
                end

                if (fishDeadFishEnabled:get_value()) then
                    fishEnts[i]:set_prop("DT_CFish:m_lifeState", 2)
                end

                if (fishFeetEnabled:get_value()) then
                    setFishValues(fishEnts[i], vector.new(localOrigin.x, localOrigin.y, localOrigin.z), localOrigin.x, localOrigin.y, localOrigin.z)
                end

                if (fishModelChangerEnabled:get_value()) then
                    if (fishModelIndex:get_value() >= 50) then
                        fishEnts[i]:set_prop("DT_CFish:m_nModelIndex", fishModelIndex:get_value())
                    end
                end
            end
        end
    end
end